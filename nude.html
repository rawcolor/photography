<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Raw Color Photography â€“ Nude</title>
  <style>
    :root{
      --bg:#0a0a0a;--bg-2:#111;--text:#d6d6d6;--muted:#9a9a9a;--accent:#7fd1b9;--max:1200px;
      --gap:14px;            /* grid gap, keep in sync with JS */
      --row:8px;             /* base row height unit, keep in sync with JS */
      --tile-radius:10px;
      --min-portrait:360px;  /* tweak to taste */
    }
    @media (max-width:700px){ :root{ --min-portrait:280px; } }

    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial,sans-serif}
    a{color:inherit;text-decoration:none}

    /* Header */
    .site-header{position:sticky;top:0;z-index:50;backdrop-filter:saturate(1.2) blur(4px);background:rgba(10,10,10,.85);border-bottom:1px solid #1e1e1e}
    .header-wrap{max-width:var(--max);margin:0 auto;display:flex;align-items:center;justify-content:space-between;padding:16px 20px}
    .brand{font-size:clamp(18px,2.3vw,28px);font-weight:600;letter-spacing:.2px;white-space:nowrap}
    nav ul{display:flex;gap:22px;list-style:none;margin:0;padding:0;align-items:center}
    nav a{color:var(--muted);font-size:14px;letter-spacing:.4px;padding:6px 0;border-bottom:2px solid transparent;transition:color .15s,border-color .15s}
    nav a:hover{color:var(--text)} nav a.active{color:var(--text);border-bottom-color:var(--accent)}
    .icon{display:inline-flex;width:18px;height:18px;vertical-align:middle;opacity:.9}

    .section{max-width:var(--max);margin:0 auto;padding:28px 20px 56px}

    /* Masonry via CSS Grid + measured row spans */
    .grid{display:grid;grid-template-columns:repeat(auto-fill, minmax(230px, 1fr));grid-auto-rows:var(--row);gap:var(--gap)}

    .tile{
      display:block;background:var(--bg-2);border:1px solid #1a1a1a;border-radius:var(--tile-radius);
      overflow:hidden;box-shadow:0 2px 6px rgba(0,0,0,.25);transition:transform .2s
    }
    .tile:hover{transform:translateY(-2px)}
    .tile img{display:block;width:100%;height:auto}

    /* Column span helpers */
    .tile.span2{grid-column:span 2}
    .tile.span3{grid-column:span 3}
    @media (max-width:1000px){ .tile.span3{grid-column:span 2} }
    @media (max-width:700px){ .tile.span2,.tile.span3{grid-column:auto} }

    /* Group divider (no visible headers) */
    .group + .group{margin-top:28px;padding-top:10px;position:relative}
    .group + .group::before{
      content:"";position:absolute;left:0;right:0;top:0;height:1px;
      background:linear-gradient(to right, transparent, #222 18%, #222 82%, transparent)
    }

    footer{border-top:1px solid #1e1e1e;color:var(--muted);text-align:center;padding:24px 16px 40px;font-size:13px}
  </style>
</head>
<body>
  <header class="site-header" role="banner">
    <div class="header-wrap">
      <div class="brand">Raw Color Photography</div>
      <nav aria-label="Primary">
        <ul>
          <li><a href="index.html">Portrait</a></li>
          <li><a href="food.html">Food</a></li>
          <li><a href="nude.html" class="active">Nude</a></li>
          <li><a href="mailto:hello@example.com">Contacts</a></li>
          <li>
            <a href="https://instagram.com/" target="_blank" rel="noopener" aria-label="Instagram">
              <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                <rect x="3" y="3" width="18" height="18" rx="5"></rect>
                <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path>
                <line x1="17.5" y1="6.5" x2="17.5" y2="6.5"></line>
              </svg>
            </a>
          </li>
        </ul>
      </nav>
    </div>
  </header>

  <section class="section" id="gallery"></section>

  <footer>&copy; <span id="y"></span> Raw Color Photography</footer>

  <script>
    document.getElementById('y').textContent = new Date().getFullYear();

    // Keep order; group by first letter for subtle dividers
    const files = [
      "A1.jpeg","A2.jpg","A3.jpg","A4.jpeg","A5.jpg","A6.jpg",
      "B1.jpg","B2.jpg",
      "C1.jpg","C2.jpg",
      "D1.jpg","D2.jpg"
    ];

    function niceAlt(n){return n.replace(/\.[^.]+$/,'').replace(/[-_]+/g,' ').replace(/\s+/g,' ').trim();}

    // Group by first letter
    const byLetter = {};
    files.forEach(n => { const k = n[0].toUpperCase(); (byLetter[k] ||= []).push(n); });

    const gallery = document.getElementById('gallery');

    /* ---------- layout helpers ---------- */
    const epsRow = 6;            // px tolerance to consider "same row"
    const similarPct = 0.10;     // 10% height similarity threshold
    function rect(el){ return el.getBoundingClientRect(); }
    function rowKey(el){ return Math.round(rect(el).top / epsRow) * epsRow; }
    function measureH(img){ return rect(img).height || 0; }

    function setRowSpan(tile, grid, height){
      const cs = getComputedStyle(grid);
      const gap = parseFloat(cs.getPropertyValue('--gap')) || 14;
      const row = parseFloat(cs.getPropertyValue('--row')) || 8;
      const rows = Math.max(1, Math.ceil((height + gap) / (row + gap)));
      tile.style.gridRowEnd = `span ${rows}`;
    }
    function applySpan(tile, n){
      tile.classList.remove('span2','span3');
      if (n === 2) tile.classList.add('span2');
      if (n === 3) tile.classList.add('span3');
    }

    // try to reach min height by widening: 1 -> 2 -> 3
    function escalateToMin(tile, img, grid, minH){
      const MAX_SPAN = 3;
      let span = 1;
      const step = () => {
        requestAnimationFrame(() => {
          const h = measureH(img);
          if (h < minH && span < MAX_SPAN) {
            span += 1;
            applySpan(tile, span);
            step();
          } else {
            setRowSpan(tile, grid, measureH(img));
          }
        });
      };
      applySpan(tile, span);
      step();
    }

    // phase 2: row-aware promotion
    function promoteRowAware(grid){
      const minPortrait = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--min-portrait')) || 360;
      // build rows
      const tiles = Array.from(grid.querySelectorAll('.tile'));
      const rows = new Map();
      tiles.forEach(t => {
        const k = rowKey(t);
        if (!rows.has(k)) rows.set(k, []);
        rows.get(k).push(t);
      });

      rows.forEach(tilesInRow => {
        // candidates: portrait, currently span1, below min height
        const candidates = tilesInRow
          .map(t => {
            const img = t.querySelector('img');
            const isPortrait = img && img.naturalHeight >= img.naturalWidth;
            return { t, img, isPortrait, h: img ? measureH(img) : 0 };
          })
          .filter(o =>
            o.isPortrait &&
            !o.t.classList.contains('span2') &&
            !o.t.classList.contains('span3') &&
            o.h > 0 && o.h < minPortrait
          );

        candidates.forEach(o => {
          // check for a same-row peer with similar height (+/-10%)
          const hasPeer = candidates.some(p => {
            if (p.t === o.t) return false;
            const bigger = Math.max(p.h, o.h), smaller = Math.min(p.h, o.h);
            return (bigger - smaller) / bigger <= similarPct;
          });

          if (!hasPeer) {
            // lonely shorty -> escalate
            escalateToMin(o.t, o.img, grid, minPortrait);
          } else {
            // keep both span1 but set proper row span for current height
            setRowSpan(o.t, grid, o.h);
          }
        });

        // Non-candidates still need row span set (landscapes or already tall)
        tilesInRow.forEach(t => {
          if (candidates.find(c => c.t === t)) return;
          const img = t.querySelector('img');
          if (img && img.complete) setRowSpan(t, grid, measureH(img));
        });
      });
    }

    function initialPlace(grid){
      // Landscapes start span2, portraits span1
      grid.querySelectorAll('.tile').forEach(tile => {
        const img = tile.querySelector('img');
        if (!img) return;
        const isPortrait = img.naturalHeight >= img.naturalWidth;
        applySpan(tile, isPortrait ? 1 : 2);
      });
      // After layout settles, do the row-aware pass
      requestAnimationFrame(() => promoteRowAware(grid));
    }

    function appendTile(grid, name){
      const a = document.createElement('a');
      a.className = 'tile';
      a.href = "nude/" + encodeURIComponent(name);
      a.target = "_blank";

      const img = document.createElement('img');
      img.loading = 'lazy';
      img.decoding = 'async';
      img.alt = niceAlt(name);
      img.src = "nude/" + encodeURIComponent(name);

      // when last image in a batch loads, (re)run placement
      img.onload = () => initialPlace(grid);

      a.appendChild(img);
      grid.appendChild(a);
    }

    // Reflow on resize (debounced)
    let resizeTimer;
    window.addEventListener('resize', () => {
      clearTimeout(resizeTimer);
      resizeTimer = setTimeout(() => {
        document.querySelectorAll('.group .grid').forEach(grid => promoteRowAware(grid));
      }, 120);
    });

    // Render groups (no headings; subtle divider between groups)
    Object.keys(byLetter).sort().forEach(k => {
      const group = document.createElement('div');
      group.className = 'group';

      const grid = document.createElement('div');
      grid.className = 'grid';

      byLetter[k].forEach(name => appendTile(grid, name));

      group.appendChild(grid);
      gallery.appendChild(group);
    });
  </script>
</body>
</html>
