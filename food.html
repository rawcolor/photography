<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Raw Color Photography – Food</title>
  <style>
    :root{
      --bg:#0a0a0a;--bg-2:#111;--text:#d6d6d6;--muted:#9a9a9a;--accent:#7fd1b9;--max:1200px;
      --gap:14px;            /* grid gap, keep in sync with JS */
      --row:8px;             /* base row height unit, keep in sync with JS */
      --tile-radius:10px;
      --min-portrait:360px;  /* tweak to taste */
    }
    @media (max-width:700px){ :root{ --min-portrait:280px; } }

    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial,sans-serif}
    a{color:inherit;text-decoration:none}

    /* Header */
    .site-header{position:sticky;top:0;z-index:50;backdrop-filter:saturate(1.2) blur(4px);background:rgba(10,10,10,.85);border-bottom:1px solid #1e1e1e}
    .header-wrap{max-width:var(--max);margin:0 auto;display:flex;align-items:center;justify-content:space-between;padding:16px 20px}
    .brand{font-size:clamp(18px,2.3vw,28px);font-weight:600;letter-spacing:.2px;white-space:nowrap}
    nav ul{display:flex;gap:22px;list-style:none;margin:0;padding:0;align-items:center}
    nav a{color:var(--muted);font-size:14px;letter-spacing:.4px;padding:6px 0;border-bottom:2px solid transparent;transition:color .15s,border-color .15s}
    nav a:hover{color:var(--text)} nav a.active{color:var(--text);border-bottom-color:var(--accent)}
    .icon{display:inline-flex;width:18px;height:18px;vertical-align:middle;opacity:.9}

    /* Make nav drop to a new row on small screens */
    @media (max-width:700px){
      .header-wrap{
        flex-direction:column;       /* stack brand then nav */
        align-items:flex-start;
        gap:8px;
      }
      nav ul{
        width:100%;                  /* allow wrapping full width */
        justify-content:space-between;
        flex-wrap:wrap;
        row-gap:8px;
        column-gap:16px;
      }
    }

    .section{max-width:var(--max);margin:0 auto;padding:28px 20px 56px}

    /* Masonry via CSS Grid + measured row spans */
    .grid{display:grid;grid-template-columns:repeat(auto-fill, minmax(230px, 1fr));grid-auto-rows:var(--row);gap:var(--gap)}

    .tile{
      display:block;background:var(--bg-2);border:1px solid #1a1a1a;border-radius:var(--tile-radius);
      overflow:hidden;box-shadow:0 2px 6px rgba(0,0,0,.25);transition:transform .2s
    }
    .tile:hover{transform:translateY(-2px)}
    .tile img{display:block;width:100%;height:auto}

    /* Column span helpers */
    .tile.span2{grid-column:span 2}
    .tile.span3{grid-column:span 3}
    @media (max-width:1000px){ .tile.span3{grid-column:span 2} }
    @media (max-width:700px){ .tile.span2,.tile.span3{grid-column:auto} }

    /* Group divider (no visible headers) */
    .group + .group{margin-top:28px;padding-top:10px;position:relative}
    .group + .group::before{
      content:"";position:absolute;left:0;right:0;top:0;height:1px;
      background:linear-gradient(to right, transparent, #222 18%, #222 82%, transparent)
    }

    footer{border-top:1px solid #1e1e1e;color:var(--muted);text-align:center;padding:24px 16px 40px;font-size:13px}
  </style>
</head>
<body>
  <header class="site-header" role="banner">
    <div class="header-wrap">
      <div class="brand">Raw Color Photography</div>
      <nav aria-label="Primary">
        <ul>
          <li><a href="index.html">Portrait</a></li>
          <li><a href="food.html" class="active">Food</a></li>
          <li><a href="nude.html">Nude</a></li>
          <li><a href="mailto:hello@example.com">Contacts</a></li>
          <li>
            <a href="https://instagram.com/" target="_blank" rel="noopener" aria-label="Instagram">
              <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                <rect x="3" y="3" width="18" height="18" rx="5"></rect>
                <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path>
                <line x1="17.5" y1="6.5" x2="17.5" y2="6.5"></line>
              </svg>
            </a>
          </li>
        </ul>
      </nav>
    </div>
  </header>

  <section class="section" id="gallery"></section>

  <footer>&copy; <span id="y"></span> Raw Color Photography</footer>

  <script>
    document.getElementById('y').textContent = new Date().getFullYear();

    // Order preserved as listed; we'll still group by first letter for consistency.
    const files = [
      "A1.jpg","A2.jpg","A3.jpg"
    ];

    function niceAlt(n){return n.replace(/\.[^.]+$/,'').replace(/[-_]+/g,' ').replace(/\s+/g,' ').trim();}

    // Group by first letter
    const byLetter = {};
    files.forEach(n => { const k = n[0].toUpperCase(); (byLetter[k] ||= []).push(n); });

    const gallery = document.getElementById('gallery');

    function measureHeight(el){ return el.getBoundingClientRect().height || 0; }

    function setRowSpan(tile, grid, height){
      const styles = getComputedStyle(grid);
      const gap = parseFloat(styles.getPropertyValue('--gap')) || 14;
      const row = parseFloat(styles.getPropertyValue('--row')) || 8;
      const rows = Math.max(1, Math.ceil((height + gap) / (row + gap)));
      tile.style.gridRowEnd = `span ${rows}`;
    }

    function applySpan(tile, n){
      tile.classList.remove('span2','span3');
      if (n === 2) tile.classList.add('span2');
      if (n === 3) tile.classList.add('span3');
    }

    // Portraits: escalate span 1→2→3 until >= min height
    function sizePortrait(tile, img, grid, minPortrait){
      const MAX_SPAN = 3;
      let span = 1;

      const step = () => {
        requestAnimationFrame(() => {
          const h = measureHeight(img);
          if (h < minPortrait && span < MAX_SPAN) {
            span += 1;
            applySpan(tile, span);
            step();
          } else {
            setRowSpan(tile, grid, measureHeight(img));
          }
        });
      };

      applySpan(tile, span);
      step();
    }

    // Landscapes always span 2 columns
    function sizeLandscape(tile, img, grid){
      applySpan(tile, 2);
      requestAnimationFrame(() => setRowSpan(tile, grid, measureHeight(img)));
    }

    function appendTile(grid, name){
      const a = document.createElement('a');
      a.className = 'tile';
      a.href = "food/" + encodeURIComponent(name);
      a.target = "_blank";

      const img = document.createElement('img');
      img.loading = 'lazy';
      img.decoding = 'async';
      img.alt = niceAlt(name);
      img.src = "food/" + encodeURIComponent(name);

      img.onload = () => {
        const minPortrait = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--min-portrait')) || 360;
        const isPortrait = img.naturalHeight >= img.naturalWidth;
        if (isPortrait) sizePortrait(a, img, grid, minPortrait);
        else            sizeLandscape(a, img, grid);
      };

      a.appendChild(img);
      grid.appendChild(a);
    }

    // Reflow on resize (debounced)
    let resizeTimer;
    window.addEventListener('resize', () => {
      clearTimeout(resizeTimer);
      resizeTimer = setTimeout(() => {
        document.querySelectorAll('.group .grid').forEach(grid => {
          grid.querySelectorAll('.tile').forEach(tile => {
            const img = tile.querySelector('img');
            if (!img || !img.complete) return;
            const minPortrait = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--min-portrait')) || 360;
            const isPortrait = img.naturalHeight >= img.naturalWidth;
            if (isPortrait) sizePortrait(tile, img, grid, minPortrait);
            else            sizeLandscape(tile, img, grid);
          });
        });
      }, 120);
    });

    // Render groups (no headings; subtle divider between groups)
    Object.keys(byLetter).sort().forEach(k => {
      const group = document.createElement('div');
      group.className = 'group';

      const grid = document.createElement('div');
      grid.className = 'grid';

      byLetter[k].forEach(name => appendTile(grid, name));

      group.appendChild(grid);
      gallery.appendChild(group);
    });
  </script>
</body>
</html>
